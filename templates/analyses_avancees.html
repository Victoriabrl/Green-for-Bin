{% extends "base.html" %}
{% block title %}{{ _("Analyses Avancées") }}{% endblock %}
{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/analyses_avancees_nohover.css') }}">
<div class="container my-5">
    <h2 class="mb-4 text-center">{{ _("Analyses Avancées") }}</h2>
    <p class="lead text-center">{{ _("Obtenez des insights détaillés sur vos habitudes de consommation et votre impact environnemental.") }}</p>
    <form id="ecoForm" class="card p-4 shadow-sm mx-auto" style="max-width: 600px;">
        <div class="mb-3">
            <label class="form-label">{{ _("À quelle fréquence triez-vous vos déchets ?") }}</label><br>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="q1" value="4" id="q1a1" required>
                <label class="form-check-label" for="q1a1">{{ _("Toujours") }}</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="q1" value="3" id="q1a2">
                <label class="form-check-label" for="q1a2">{{ _("Souvent") }}</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="q1" value="2" id="q1a3">
                <label class="form-check-label" for="q1a3">{{ _("Parfois") }}</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="q1" value="1" id="q1a4">
                <label class="form-check-label" for="q1a4">{{ _("Jamais") }}</label>
            </div>
        </div>
        <div class="mb-3">
            <label class="form-label">{{ _("Utilisez-vous un composteur ?") }}</label><br>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="q2" value="4" id="q2a1" required>
                <label class="form-check-label" for="q2a1">{{ _("Oui régulièrement") }}</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="q2" value="3" id="q2a2">
                <label class="form-check-label" for="q2a2">{{ _("De temps en temps") }}</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="q2" value="2" id="q2a3">
                <label class="form-check-label" for="q2a3">{{ _("Non mais j’aimerais") }}</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="q2" value="1" id="q2a4">
                <label class="form-check-label" for="q2a4">{{ _("Non ce n’est pas prévu") }}</label>
            </div>
        </div>
        <div class="mb-3">
            <label class="form-label">{{ _("Quelle quantité de déchets jetez-vous par semaine ?") }}</label><br>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="q3" value="4" id="q3a1" required>
                <label class="form-check-label" for="q3a1">{{ _("Moins d’un sac") }}</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="q3" value="3" id="q3a2">
                <label class="form-check-label" for="q3a2">{{ _("1 à 2 sacs") }}</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="q3" value="2" id="q3a3">
                <label class="form-check-label" for="q3a3">{{ _("3 à 4 sacs") }}</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="q3" value="1" id="q3a4">
                <label class="form-check-label" for="q3a4">{{ _("Plus de 4 sacs") }}</label>
            </div>
        </div>
        <div class="mb-3">
            <label class="form-label">{{ _("Achetez-vous des produits avec peu ou pas d’emballage ?") }}</label><br>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="q4" value="4" id="q4a1" required>
                <label class="form-check-label" for="q4a1">{{ _("Le plus possible") }}</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="q4" value="3" id="q4a2">
                <label class="form-check-label" for="q4a2">{{ _("Parfois") }}</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="q4" value="2" id="q4a3">
                <label class="form-check-label" for="q4a3">{{ _("Rarement") }}</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="q4" value="1" id="q4a4">
                <label class="form-check-label" for="q4a4">{{ _("Jamais") }}</label>
            </div>
        </div>
        <div class="mb-3">
            <label class="form-label">{{ _("Réparez-vous, donnez-vous ou revendez-vous vos objets usagés ?") }}</label><br>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="q5" value="4" id="q5a1" required>
                <label class="form-check-label" for="q5a1">{{ _("Oui systématiquement") }}</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="q5" value="3" id="q5a2">
                <label class="form-check-label" for="q5a2">{{ _("Parfois") }}</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="q5" value="2" id="q5a3">
                <label class="form-check-label" for="q5a3">{{ _("Rarement") }}</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="q5" value="1" id="q5a4">
                <label class="form-check-label" for="q5a4">{{ _("Jamais") }}</label>
            </div>
        </div>
        <div class="mb-3">
            <label class="form-label">{{ _("Avez-vous déjà participé à une initiative écologique ?") }}</label><br>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="q6" value="4" id="q6a1" required>
                <label class="form-check-label" for="q6a1">{{ _("Oui") }}</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="q6" value="3" id="q6a2">
                <label class="form-check-label" for="q6a2">{{ _("Non mais je suis intéressé·e") }}</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="q6" value="2" id="q6a3">
                <label class="form-check-label" for="q6a3">{{ _("Non ce n’est pas mon truc") }}</label>
            </div>
        </div>
        <div class="mb-3">
            <label class="form-label">{{ _("Connaissez-vous votre impact environnemental ou empreinte carbone ?") }}</label><br>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="q7" value="4" id="q7a1" required>
                <label class="form-check-label" for="q7a1">{{ _("Oui je l’ai déjà calculé") }}</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="q7" value="3" id="q7a2">
                <label class="form-check-label" for="q7a2">{{ _("J’en ai une vague idée") }}</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="q7" value="2" id="q7a3">
                <label class="form-check-label" for="q7a3">{{ _("Non jamais") }}</label>
            </div>
        </div>
        <button type="submit" class="btn btn-success w-100">{{ _("Soumettre") }}</button>
    </form>
    <div id="result" class="mt-4 text-center" style="display:none;"></div>
</div>
<script>
document.getElementById('ecoForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const form = e.target;
    const formData = new FormData(form);
    fetch("", {
        method: "POST",
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            let score = data.score;
            let message = '';
            // Traduction dynamique côté JS
            let titre = typeof gettext === 'function' ? gettext(data.titre) : data.titre;
            let conseil = typeof gettext === 'function' ? gettext(data.conseil) : data.conseil;
            let alert = data.alert || 'success';
            message = `<div class="alert alert-${alert}"><b>${titre}</b> : ${conseil}</div>`;
            let scoreLabel = typeof gettext === 'function' ? gettext('Votre score') : 'Votre score';
            document.getElementById('result').innerHTML = `<h4>${scoreLabel}: ${score} / 28</h4>` + message;
            document.getElementById('result').style.display = 'block';
            window.scrollTo({top: document.getElementById('result').offsetTop - 60, behavior: 'smooth'});
        } else {
            document.getElementById('result').innerHTML = '<div class="alert alert-danger">' + gettext('Erreur') + ' : ' + (data.error || gettext("Impossible d'enregistrer le score")) + '</div>';
            document.getElementById('result').style.display = 'block';
        }
    })
    .catch(() => {
        document.getElementById('result').innerHTML = '<div class="alert alert-danger">' + gettext('Erreur réseau') + '</div>';
        document.getElementById('result').style.display = 'block';
    });
});
</script>
{% endblock %}
