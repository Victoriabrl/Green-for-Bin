<style>
.carousel {
    overflow: hidden;
    position: relative;
    width: 100%;
    max-width: 100%;
    background: transparent;
    border-radius: 8px;
    box-shadow: 0 2px 8px #0001;
    margin-bottom: 20px;
}

.carousel-track {
    display: flex;
    transition: transform 0.3s ease;
    gap: 10px;
}

.carousel-item {
    flex: 0 0 auto;
    width: 300px;
    padding: 10px;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.carousel-img {
    width: 100%;
    cursor: pointer;
    border-radius: 6px;
    box-shadow: 0 1px 6px rgba(0, 0, 0, 0.1);
}

.carousel-prev, .carousel-next {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background-color: #ffffffcc;
    border: none;
    padding: 10px;
    cursor: pointer;
    font-size: 18px;
    z-index: 1;
    border-radius: 50%;
}

.carousel-prev {
    left: 10px;
}

.carousel-next {
    right: 10px;
}

.meta-hover {
    background: #f9f9f9;
    padding: 5px;
    margin-top: 5px;
    border-radius: 5px;
    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
    font-size: 14px;
}
</style>

<!-- === Carrousel VIDES === -->
<div class="carousel" id="carousel-vides-all">
    <div class="carousel-track">
        {% for image in vides %}
        <div class="carousel-item">
            <img src="{{ url_for('static', filename='uploads/' + image['filename']) }}" loading="lazy" alt="image" class="carousel-img">
            <div class="meta-hover" style="display:none;">
                <b>Métadonnées :</b><br>
                Nom : {{ image['filename'] }}<br>
                Date : {{ image['date'] if image['date'] is defined else '' }}<br>
                {% if image['width'] is defined %}Largeur : {{ image['width'] }} px<br>{% endif %}
                {% if image['height'] is defined %}Hauteur : {{ image['height'] }} px<br>{% endif %}
                {% if image['size'] is defined %}Taille : {{ image['size'] }}<br>{% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    <button class="carousel-prev" aria-label="Précédent">&#8592;</button>
    <button class="carousel-next" aria-label="Suivant">&#8594;</button>
</div>

<!-- === Carrousel PLEINES === -->
<div class="carousel" id="carousel-pleines-all">
    <div class="carousel-track">
        {% for image in pleines %}
        <div class="carousel-item">
            <img src="{{ url_for('static', filename='uploads/' + image['filename']) }}" loading="lazy" alt="image" class="carousel-img">
            <div class="meta-hover" style="display:none;">
                <b>Métadonnées :</b><br>
                Nom : {{ image['filename'] }}<br>
                Date : {{ image['date'] if image['date'] is defined else '' }}<br>
                {% if image['width'] is defined %}Largeur : {{ image['width'] }} px<br>{% endif %}
                {% if image['height'] is defined %}Hauteur : {{ image['height'] }} px<br>{% endif %}
                {% if image['size'] is defined %}Taille : {{ image['size'] }}<br>{% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    <button class="carousel-prev" aria-label="Précédent">&#8592;</button>
    <button class="carousel-next" aria-label="Suivant">&#8594;</button>
</div>

<!-- === Carrousel NON LABELISÉES === -->
<div class="carousel" id="carousel-non-labelisees-all">
    <div class="carousel-track">
        {% for image in non_labelisees %}
        <div class="carousel-item">
            <img src="{{ url_for('static', filename='uploads/' + image['filename']) }}" loading="lazy" alt="image" class="carousel-img">
            <div class="meta-hover" style="display:none;">
                <b>Métadonnées :</b><br>
                Nom : {{ image['filename'] }}<br>
                Date : {{ image['date'] if image['date'] is defined else '' }}<br>
                {% if image['width'] is defined %}Largeur : {{ image['width'] }} px<br>{% endif %}
                {% if image['height'] is defined %}Hauteur : {{ image['height'] }} px<br>{% endif %}
                {% if image['size'] is defined %}Taille : {{ image['size'] }}<br>{% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    <button class="carousel-prev" aria-label="Précédent">&#8592;</button>
    <button class="carousel-next" aria-label="Suivant">&#8594;</button>
</div>

<script>
function setupCarousel(carouselId) {
    const carousel = document.getElementById(carouselId);
    if (!carousel) return;

    const track = carousel.querySelector('.carousel-track');
    const items = track.querySelectorAll('.carousel-item');
    const prevBtn = carousel.querySelector('.carousel-prev');
    const nextBtn = carousel.querySelector('.carousel-next');
    const itemsPerPage = 8;
    let currentIndex = 0;

    function updateCarousel() {
        const offset = currentIndex * (items[0].offsetWidth + 10); // 10px gap
        track.style.transform = `translateX(-${offset}px)`;
    }

    prevBtn.onclick = () => {
        currentIndex = Math.max(0, currentIndex - itemsPerPage);
        updateCarousel();
    };

    nextBtn.onclick = () => {
        const maxIndex = Math.max(0, items.length - itemsPerPage);
        currentIndex = Math.min(maxIndex, currentIndex + itemsPerPage);
        updateCarousel();
    };

    // Toggle métadonnées
    items.forEach(item => {
        const img = item.querySelector('.carousel-img');
        const meta = item.querySelector('.meta-hover');
        if (img && meta) {
            img.onclick = function () {
                items.forEach(it => {
                    const m = it.querySelector('.meta-hover');
                    if (m && m !== meta) m.style.display = 'none';
                });
                meta.style.display = (meta.style.display === 'block') ? 'none' : 'block';
            };
        }
    });
}

// Initialisation
setupCarousel('carousel-vides-all');
setupCarousel('carousel-pleines-all');
setupCarousel('carousel-non-labelisees-all');
</script>
