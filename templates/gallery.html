{# Suppression du premier block scripts pour éviter le doublon #}
{% extends "base.html" %}

{% block title %}{{ _('Galerie') }}{% endblock %}

{% block content %}
<h2>{{ _('Galerie des images uploadées') }}</h2>

<label for="imageFilter"><b>{{ _('Filtrer par type d\'image') }} :</b></label>
<select id="imageFilter" style="margin-bottom: 20px;">
    <option value="all">{{ _('Toutes') }}</option>
    <option value="vides">{{ _('Images Vides') }}</option>
    <option value="pleines">{{ _('Images Pleines') }}</option>
    <option value="non_labelisees">{{ _('Images Non Annotées') }}</option>
</select>

<div id="allSection" class="gallery-section">
    <h3>{{ _('Toutes les images') }}</h3>
    <div class="image-grid">
        {% for image in toutes_les_images %}
        <div class="image-container">
            <img src="{{ url_for('static', filename='uploads/' + image['filename']) }}" width="200" loading="lazy" alt="image">
            <div class="meta-hover">
                <b>Métadonnées :</b><br>
                Nom : {{ image['filename'] }}<br>
                Date : {{ image['date'] if image['date'] is defined else '' }}<br>
                {% if image['width'] is defined %}Largeur : {{ image['width'] }} px<br>{% endif %}
                {% if image['height'] is defined %}Hauteur : {{ image['height'] }} px<br>{% endif %}
                {% if image['size'] is defined %}Taille : {{ image['size'] }}<br>{% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>
<div id="videsSection" class="gallery-section" style="display:none;">
    <h3>{{ _('Images Vides') }}</h3>
    <div class="image-grid">
        {% for image in vides %}
        <div class="image-container">
            <img src="{{ url_for('static', filename='uploads/' + image['filename']) }}" width="200" loading="lazy" alt="image">
            <div class="meta-hover">
                <b>Métadonnées :</b><br>
                Nom : {{ image['filename'] }}<br>
                Date : {{ image['date'] if image['date'] is defined else '' }}<br>
                {% if image['width'] is defined %}Largeur : {{ image['width'] }} px<br>{% endif %}
                {% if image['height'] is defined %}Hauteur : {{ image['height'] }} px<br>{% endif %}
                {% if image['size'] is defined %}Taille : {{ image['size'] }}<br>{% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>
<div id="pleinesSection" class="gallery-section" style="display:none;">
    <h3>{{ _('Images Pleines') }}</h3>
    <div class="image-grid">
        {% for image in pleines %}
        <div class="image-container">
            <img src="{{ url_for('static', filename='uploads/' + image['filename']) }}" width="200" loading="lazy" alt="image">
            <div class="meta-hover">
                <b>Métadonnées :</b><br>
                Nom : {{ image['filename'] }}<br>
                Date : {{ image['date'] if image['date'] is defined else '' }}<br>
                {% if image['width'] is defined %}Largeur : {{ image['width'] }} px<br>{% endif %}
                {% if image['height'] is defined %}Hauteur : {{ image['height'] }} px<br>{% endif %}
                {% if image['size'] is defined %}Taille : {{ image['size'] }}<br>{% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>
<div id="nonLabeliseesSection" class="gallery-section" style="display:none;">
    <h3>{{ _('Images Non Annotées') }}</h3>
    <div class="image-grid">
        {% for image in non_labelisees %}
        <div class="image-container">
            <img src="{{ url_for('static', filename='uploads/' + image['filename']) }}" width="200" loading="lazy" alt="image">
            <div class="meta-hover">
                <b>Métadonnées :</b><br>
                Nom : {{ image['filename'] }}<br>
                Date : {{ image['date'] if image['date'] is defined else '' }}<br>
                {% if image['width'] is defined %}Largeur : {{ image['width'] }} px<br>{% endif %}
                {% if image['height'] is defined %}Hauteur : {{ image['height'] }} px<br>{% endif %}
                {% if image['size'] is defined %}Taille : {{ image['size'] }}<br>{% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<style>
.image-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 18px;
  justify-content: flex-start;
  margin-bottom: 2.5rem;
}
.image-container {
  position: relative;
  margin: 10px;
  display: inline-block;
}
.meta-hover {
  display: none;
  position: absolute;
  top: 0;
  left: 0;
  background: rgba(255,255,255,0.97);
  color: #222;
  border: 1px solid #8fbc8f;
  border-radius: 8px;
  padding: 10px;
  z-index: 10;
  min-width: 180px;
  max-width: 250px;
  font-size: 0.95em;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}
.image-container:hover .meta-hover {
  display: block;
}
</style>
<script>
const filter = document.getElementById('imageFilter');
const sections = {
  all: document.getElementById('allSection'),
  vides: document.getElementById('videsSection'),
  pleines: document.getElementById('pleinesSection'),
  non_labelisees: document.getElementById('nonLabeliseesSection')
};
filter.addEventListener('change', function() {
  Object.keys(sections).forEach(function(key) {
    if(key === filter.value) {
      sections[key].style.display = '';
    } else {
      sections[key].style.display = 'none';
    }
  });
});
// Affiche "Toutes" par défaut
window.addEventListener('DOMContentLoaded', function() {
  filter.value = 'all';
  Object.keys(sections).forEach(function(key) {
    if(key === 'all') {
      sections[key].style.display = '';
    } else {
      sections[key].style.display = 'none';
    }
  });
});
</script>
{% endblock %}

