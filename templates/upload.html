{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h2>{{ _("Uploader une image") }}</h2>
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}
    <form id="upload-form" method="POST" action="{{ url_for('upload') }}" enctype="multipart/form-data">
        <label for="file-upload" class="btn btn-success" style="margin-right: 10px;">
            {{ _('Choisir un fichier') }}
        </label>
        <input id="file-upload" type="file" name="image" accept=".jpg, .jpeg, .png" style="display:none" required>
        <span id="file-name">{{ _('Aucun fichier choisi') }}</span>
        <button type="submit" class="btn btn-outline-success" style="margin-left:10px;">Uploader</button>
    </form>
    {% if session.role != 'admin' %}
    <div id="progress-container" class="progress mt-3" style="height: 30px; display: none;">
        <div id="progress-bar" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%; height: 100%;">0%</div>
    </div>
    <div id="prediction-result" class="mt-3"></div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
document.getElementById('file-upload').addEventListener('change', function() {
    var fileName = this.files.length > 0 ? this.files[0].name : "{{ _('Aucun fichier choisi') }}";
    document.getElementById('file-name').textContent = fileName;
});
</script>
{% if session.role != 'admin' %}
<script src="{{ url_for('static', filename='js/upload_progress.js') }}"></script>
{% endif %}
{% endblock %}
